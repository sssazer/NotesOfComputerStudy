# 1. QuickStart

Swing是Java的GUI库，使用时需要导包 `import javax.swing.*;`

## 1.1 创建画板Panel

panel相当于一个画板组件，Graphics就是画笔，提供了很多绘制形状的方法

```java
class MyPanel extends JPanel {
    @Override 
    public void paint(Graphics g) {
        // 调用父类的方法完成初始化，第一行必须是这个
        super.paint(g);
        
        // 画一个圆
        g.drawOval(10, 10, 100, 100);
    }
}
```

paint方法调用时机

- 第一次在屏幕显示的时候，会自动调用paint方法
- 窗口最小化到托盘，再最大化之后会再次调用
- 窗口大小发生变化时会调用
- repaint函数被调用时

## 1.2 创建窗口Frame

```java
public MyFrame extends JFrame {
    public static void main(String[] args) {
        new MyFrame();
    }
    
    // 构造器
    public MyFrame() {
        // 创建画板对象
        mp = new MyPanel();
        // 将画板添加至窗口中
        this.add(mp);
        // 设置窗口属性
        this.setSize(300, 400); // 窗口大小
        this.setVisible(true); // 设置窗口可见性
        this.setDefaultCloseOperation(JFame.EXIT_ON_CLOSE); // 当关闭窗口时程序也一起关闭
    }
}
```

# 2. Graphics画笔类

Graphics类中提供了各种绘制图形的方法

## 2.1 设置画笔属性

### 2.1.1 setColor设置颜色

```java
g.getColor(Color.red);
```

### 2.1.2 setFont设置字体

`setFont(Font font)`

需要传入一个Font对象来为当前画笔设置字体

```java
g.setFont(new Font("隶书", Font.BOLD, 50));
```

设置字体、字体形状和字体大小

## 2.2 绘制图形

### 2.2.1 drawLine画直线

`drawLine(int x1, int y2, int x2, int y2)`

从(x1,y1) 到 (x2,y2) 画一条线

### 2.2.2 drawRect画矩形

`drawRect(int x, int y, int width, int height)`

矩形的左上角坐标为（x,y），宽和高分别为width和height

### 2.2.3 fillRect填充矩形

指定一个矩形区域并使用当前画笔颜色填充

`fillRect(int x, int y, int width, int height)`

### 2.2.4 drawOval画椭圆

`drawOval(int x, int y, int width, int height)`

指定一个矩形区域，画一个外切于该矩形的椭圆轮廓

### 2.2.5 fillOval填充椭圆

指定一个椭圆区域，并用当前画笔颜色填充

`fillOval(int x, int y, int width, int height)`

### 2.2.6 drawImage画图片

1. 获取图片资源

   ```java
   Image image = Toolkit.getDefaultToolkit().
       getImage(Panel.class.getResource(imagePath));
   ```

   图片最好放在项目目录下，使用相对路径

2. 画图

   `g.drawImage(image, x, y, width, height, this);`

   表示在画板的(x,y)位置开始画图，图片宽高分别为(width, height)，this表示在当前画板上画

### 2.2.7 drawString写字

写字之前最好先设置字体和画笔颜色

```java
g.drawString("HelloWorld！", 100, 100);
```

后面两个参数是字左下角坐标

### 2.2.8 fill3DRect画3D矩形

`fill3DRect(int x, int y, int width, int height, boolean raised)`

这样画出的矩形有3D高光效果

最后的布尔类型参数用于指定该矩形是高于表面还是嵌入表面中

# 3. 事件处理机制

![](./4/3事件处理机制.png)

当发生事件时（比如键盘上一个键被按下），那么产生事件的对象（事件源）会将该事件封装成一个对象（比如KeyEvent对象）传递给事件监听者（实现了KeyListener的类），进而事件监听者可以做出处理

## 3.1 键盘事件监听

1. 用一个类实现`KeyListener`接口

2. 在JFrame窗口的构造器中加入监听对象`this.addKeyListener(KeyListener l);`

3. 在实现KeyListener接口的类中重写keyPressed keyReleased keyTyped即可监听到键盘被按住、被松开和被按下

```java
// 键盘被按下
@Override
public void keyTyped(KeyEvent e) {
    
}

// 键盘被按住
@Override
public void keyPressed(KeyEvent e) {
    
}

// 键盘被松开
@Override void keyReleased(KeyEvent e) {
    
}
```

可以用`e.getKeyCode()`来获取具体是哪个按键触发的事件

键盘上的每个按键都是`KeyEvent`类中的一个`static final`静态常量值

### 3.1.1 控制小球移动

```java
public class MoveTest extends JFrame {
    public static void main(String[] args) {
        new MoveTest();
    }

    public MoveTest() {
        MyPanel1 mp1 = new MyPanel1();

        this.addKeyListener(mp1); // 将键盘监听对象加入窗口中

        this.add(mp1);
        this.setSize(1000, 1000);
        this.setVisible(true);
        this.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
    }
}

class MyPanel1 extends JPanel implements KeyListener {
    int x = 10;
    int y = 10;
    @Override
    public void paint(Graphics g) {
        super.paint(g);
        g.fillOval(x, y, 10, 10);
    }

    @Override
    public void keyTyped(KeyEvent e) {

    }

    @Override
    public void keyPressed(KeyEvent e) {
        // 根据监听到的按键更改坐标
        switch (e.getKeyCode()) {
            case KeyEvent.VK_UP:
            case KeyEvent.VK_W:
                y--;
                break;
            case KeyEvent.VK_DOWN:
            case KeyEvent.VK_S:
                y++;
                break;
            case KeyEvent.VK_LEFT:
            case KeyEvent.VK_A:
                x--;
                break;
            case KeyEvent.VK_RIGHT:
            case KeyEvent.VK_D:
                x++;
                break;
        }
        // 更改坐标之后要记得重绘
        this.repaint();
    }

    @Override
    public void keyReleased(KeyEvent e) {

    }
}
```

## 3.2 窗口事件监听

在JFrame构造器中增加对相应窗口事件的监听

```java
public class MyFrame extends JFrame {
    public MyFrame () {
        this.addWindowListener(new WindowAdapter() {
        	// 在这里重写方法即可监听不同的窗口事件 
        });
    }
} 
```

- 窗口关闭事件

```java
@Override
public void windowClosing(WindowEvent e) {
    sout("检测到窗口被关闭");
    System.exit(0);
}
```

## 3.3 点击按钮事件

```java
JButton btn = new JButton("登录"); // 按钮上显示的字
this.add(btn); // 将btn组件加入到JPanel中

btn.addActionListener(new ActionListener() {
   @Override
    public void actionPerformed(ActionEvent e) {
        // 按钮被点击后自动执行这个函数
    }
});
```

# 4. Swing界面案例

## 4.1 聊天室系统

### 4.1.1 登录界面

```java
public class LoginPanel extends JPanel{

    public LoginPanel() {
        this.setLayout(null);

        // 提示文本：用户名
        JLabel nameLabel = new JLabel("用户名：");
        nameLabel.setBounds(30, 20, 80,25);
        this.add(nameLabel);

        // 用户名输入框
        JTextField nameTextField = new JTextField(20);
        nameTextField.setBounds(100, 20, 165, 25);
        this.add(nameTextField);

        // 提示文本：密码
        JLabel pwdLabel = new JLabel("密码：");
        pwdLabel.setBounds(30, 50, 80, 25);
        this.add(pwdLabel);

        // 密码输入框
        JPasswordField pwdPasswordField = new JPasswordField(20);
        pwdPasswordField.setBounds(100, 50, 165, 25);
        this.add(pwdPasswordField);

        // 警告信息
        JLabel warnNoneUsername = new JLabel(); // 用户名为空
        warnNoneUsername.setForeground(Color.red);
        warnNoneUsername.setBounds(275, 20, 80, 25);
        this.add(warnNoneUsername);
        JLabel warnNonePwd = new JLabel(); // 密码为空
        warnNonePwd.setForeground(Color.red);
        warnNonePwd.setBounds(275, 50, 80, 25);
        this.add(warnNonePwd);
        JLabel warnLoginFault = new JLabel(); // 登录失败
        warnLoginFault.setForeground(Color.red);
        warnLoginFault.setBounds(100, 70, 160, 30);
        this.add(warnLoginFault);

        // 登录按钮
        JButton loginButton = new JButton("登录");
        loginButton.setBounds(130, 100, 80, 25);
        this.add(loginButton);
        // 给按钮添加点击事件
        loginButton.addActionListener(new ActionListener() {
            @Override
            public void actionPerformed(ActionEvent e) {
                // 获取用户输入的用户名和密码并保证非空
                String usrName = nameTextField.getText();
                // 用户名为空时显示提示信息
                if ("".equals(usrName)) {
                    warnNoneUsername.setText("用户名为空");
                    return;
                } else {
                    warnNoneUsername.setText("");
                }
                String pwd = new String(pwdPasswordField.getPassword());
                // 密码为空时显示提示信息
                if ("".equals(pwd)) {
                    warnNonePwd.setText("密码为空");
                    return;
                } else {
                    warnNonePwd.setText("");
                }

                // 调用登录服务
                if (loginService.checkUser(usrName, pwd)) {
                    user = new User(usrName, pwd);
                    changePanel(); // 界面跳转，进入系统主页
                } else {
                    warnLoginFault.setText("用户名不存在或密码错误");
                }
            }
        });
    }
}
```

### 4.1.2 界面跳转功能

```java
private void changePanel () {
    loginPanel.setVisible(false);

    this.setSize(800,600);
    chatPanel = new ChatPanel();
    this.add(chatPanel);
    chatPanel.setVisible(true);
}
```

就是将登录界面设为不可见，将系统主页界面设为可见

### 4.1.3 聊天室界面

```java
public class ChatPanel extends JPanel {

    JTextArea chatTextArea = null;
    JTextField inputTextField = null;

    public ChatPanel () {
        // 设置布局模式
        this.setLayout(new BorderLayout());

        /********设置聊天记录显示框***********/
        JScrollPane scrollPane = new JScrollPane(); // 滚动条
        // 设置滚动条的出现规则
        scrollPane.setHorizontalScrollBarPolicy(ScrollPaneConstants.HORIZONTAL_SCROLLBAR_NEVER);
        scrollPane.setVerticalScrollBarPolicy(ScrollPaneConstants.VERTICAL_SCROLLBAR_AS_NEEDED);
        // 设置文本显示区域
        chatTextArea = new JTextArea(30, 100);
        chatTextArea.setFocusable(false); // 隐藏光标
        scrollPane.setViewportView(chatTextArea); // 将文本显示区域放入滚动条区域中
        this.add(scrollPane, BorderLayout.CENTER); // 将滚动条区域加入Panel

        /*************设置文本输入框*******************/
        JPanel inputPanel = new JPanel();
        // 输入框
        inputTextField = new JTextField(30);
        inputTextField.requestFocus();
        
        inputPanel.add(inputTextField);
        // 发送按钮
        JButton sendBtn = new JButton("发送");
        sendBtn.addActionListener(new ActionListener() {
            @Override
            public void actionPerformed(ActionEvent e) {
                String text = inputTextField.getText();
                if (sendText(text)) {
                    // 时间戳
                    DateTimeFormatter dtf = DateTimeFormatter.ofPattern("HH:mm:ss");
                    String date = dtf.format(LocalDateTime.now());
                    addText(dtf.format(LocalDateTime.now()) + "  我 ： " + text);
                }
            }
        });
        inputPanel.add(sendBtn);

        this.add(inputPanel, BorderLayout.SOUTH);
    }

    /**
     * 向聊天记录框中加入消息
     * @param text - 要添加的文本信息
     */
    public void addText(String text) {
        chatTextArea.append(" " + text + "\n");
    }

    /**
     * 点击发送按钮之后发送消息
     */
    public boolean sendText(String text) {
        if ("".equals(text)) {
            JOptionPane.showMessageDialog(MainMenu.this, "发送内容不能为空");
            return false;
        }
        UtilFunction.sendAllUser(text);
        inputTextField.setText("");
        inputTextField.requestFocus();
        return true;
    }
} 
```

