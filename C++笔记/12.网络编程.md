# 1. C++ Sockets简介

## 1.1 名词解释

- Winsock：Sockets最初是为Unix系统开发的，之后Windos系统对其做了实现，称为Winsock

- WSA：Windows Sockets API

- ws2_32.dll：(C:\WINDOWS\System32)，Winsock的核心组件，实现软件到硬件的底层交互功能

  是一个动态链接库文件（dll——dynamic link library），里面包含了编译好的代码，可以被不同的应用直接拿来复用

## 1. 2 端口号

- 开发网络程序时，服务器端的端口号一般是在代码中指定，而客户端的端口号由操作系统分配
- 端口号有16位，可以是1~65535的任何整数
- 1~1023是熟知端口号，被保留用作特定的应用
- 推荐使用大于1024的端口号，以确保想要的端口号没有被占用

## 1.3 Sockets

**定义：**

A pipe between two computers on a network through which data flows —— by Mulholland 2004

**特点：**

- Sockets是双向的，在一个socket中既可以发送数据也可以接收数据
- socket有两种常见的形式：tcp和udp
- 基本上Winsock中的所有函数都运行在socket上

# 2. Create A Socket Of Server

## 2.1 创建过程概述

### 2.1.1 Status of a Server

1. Unbound：刚创建一个新的Server，但是还没有绑定IP和端口号

2. Bound：给服务器端绑定一个合法的ip地址和端口号

3. Listening：在指定端口监听连接请求

4. Connected：当发现连接请求时，服务器端会建立（复制）一个新的socket来与客户端建立连接，而原来的socket会继续监听来自其他客户端的请求

   复制出来的socketip和端口号都和原来相同

   ![](./12/2.1.1-1connected.png)

### 2.1.2 Server Functions

1. Initialize WSA 初始化：`WSAStartup()`
2. Create a socket 创建：`socket()`
3. Bind the socket 绑定IP和端口: `bind()`
4. Listen on the socket 监听: `listen()`
5. Accept a connection 建立连接: `accept()`, `connect()`
6. Send and receive data 发送和接收数据: `recv()`, `send()`, `recvfrom()`, `sendto()`
7. Disconnect 断开连接: `closesocket()`

## 2.2 Step1 - Load DLL



# 3. Client

## 3.1 创建过程概述

### 3.1.1 Status of Client

1. Unbound
2. Bound：其中端口号是自动分配的
3. Connected

### 3.1.2 Client Functions

1. Initialize WAS 初始化: `WSAStartup()`
2. Create a socket 创建: `socket`
3. Connect to the server 向服务器端发出连接请求：`connect()`
4. Send and receive data 发送和接收数据：`recv()`, `send()`, `recvfrom()`, `sendto()`
5. Disconnect 关闭连接：`closesocket()`