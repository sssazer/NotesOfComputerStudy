# 1. 本来应该有个1的

# 2. Linux组的介绍

在Linux组中，每个用户都必须属于某一个组

## 2.1 文件所属组

对于一个文件来说，有三个概念

### 2.1.1 所有者：

一般哪个用户创建的，文件的所有者就是哪个用户，也可以修改

- 查看文件所有者：`ls -ahl` 或 `ll`

    列出目录下所有文件及其所有者。
    
    - -a：显示隐藏文件，
    - -h：以便于阅读的方式显示文件大小，
    - -l：每个文件占一行，显示文件详细信息

- 修改文件所有者：`chown 用户名A 文件名a` (change owner)

    把文件a的所有者改为用户A

    修改文件所有者并不会同步修改文件所在组

    `chown -R 用户名 目录名`可以修改目录及其中所有文件目录的所有者

### 2.1.2 所在组：

文件的所有者属于的组就是文件的所在组。

- 查看文件/目录所在组 `ls -ahl`

- 修改文件所在组 `chgrp 组名 文件名`

    修改目录所在组：`chgrp -R 组名 目录名`

### 2.1.3 其他组：

除了所在组以外的组对于文件来说都是其他组

# 3. Linux rwx 权限

r：read，w：write，x：execute

## 3.1 rwx作用到文件上

对文件操作除了需要有对该文件的相应权限，首先还要有对文件所在文件夹的相应权限。连目录都进不去更不用说操作文件

- r：可以读取，查看文件

- w：可以修改

    但是不代表可以删除该文件，想删除文件必须对文件所在目录有写权限

- x：可以被执行（前提是该文件是可执行文件）

## 3.1 rwx作用在目录上

- r：可以读取目录，指ls列出目录内容

    但是不可以cd进入该目录，不可以对目录中文件进行操作(即使有对该文件的操作权限)

    并且只能用ls命令列举目录中文件名字，不能用ls -l或ll列举详细信息

- w：可以修改目录

    对目录内的文件创建、删除、重命名目录

- x：可以进入该目录，即cd进该目录

    ls权限不够，但是可以对目录中的文件进行操作

## 3.3 修改权限 chmod

u：所有者，g：所在组，o：其他组，a：所有人（u、g、o的总和）

- `chmod u=rwx,g=rx,o=x 文件名/目录名`

    赋予权限

- `chmod o+w 文件/目录名`

    增加权限

- `chomod a-x 文件/目录名`

    去除权限

- 还可以直接用数字变更权限

    - r=4
    - w=2
    - x=1
    
    实际上就是rwx三位二进制，可以随意组合

    示例：`chmod 751 文件名/目录名`：给所有者赋予rwx，所在组赋予r-x，其他组赋予--x

# 4. 任务调度

是指系统在某个时间执行特定的命令或程序

- crond定时任务调度：反复执行
- at定时任务：一次性定时计划任务

## 4.1 crond 定时任务调度

`crontab [选项]` 之后按Enter，在新窗口中写命令

**常用选项：**

- -e：编辑crontab定时任务
- -l：串crontab任务
- -r删除当前用户所有的crontab任务
- `service crond restart`：重启任务调度

**命令格式：**

`* * * * * 要执行的具体指令或shell脚本`

五个*表示五个时间占位符

- 第一个*：分钟，0-59
- 第二个*：小时，0-23
- 第三个*：日期，一个月中的第几天，1-31
- 第四个*：月份，1-12
- 第五个*：星期几，0-7（0和7都代表星期日）

**特殊符号：**

以第一个位置为例

- *：表示任意时间（所有时间）

    比如第一个*表示每分钟都执行，

- */n：表示每隔n分钟执行一次

    `*/10 4 * * *` 每天凌晨4点，每隔十分钟执行一次（即4.00，4.10，4.20，4.30，4.40，4.50）

- 逗号，：表示不连续的时间

    比如 `0，20，40 * * * *`表示每小时的0分，20分，40分执行

- 短杠-：表示连续的时间范围

    比如 `0 5 * * 1-6`，代表周一到周六每天5点0分执行命令

## 4.2 at 定时任务

### 基本介绍

系统会在后台运行一个at的守护进程atd，来检查作业队列（默认每隔60s检查一次）。如果某个作业规定运行的时间与当前时间匹配，则运行此作业

`ps -ef`查看所有进程

`ps -ef | grep atd`检测atd是否在运行

### 向作业队列中添加作业

1. `at [选项] [时间]` 
2. 按回车，之后输入要执行的指令或shell脚本
3. 之后按两次ctrl+D结束at命令的输入

选项：

- atq：查看系统中还没有执行的工作任务

- atrm 编号：删除已经设置的指定编号的任务（任务执行完后会自动删除）
时间：

- hh:mm(小时分钟)

    如果当天该时间还没过去就当天执行，如果过去了就第二天执行

- 模糊词语指定

    比如midnight，noon，teatime（一般是下午四点）

- 12小时计时制

    在时间后面加上AM，PM。比如8AM

- 具体日期，格式有：month day、mm/dd/yy（月/日/年）、dd.mm.yy（日.月.年）

    指定日期必须在指定时间的后面

- 相对计时法：now + count time-units

    now是指当前时间，time-units时间单位——minutes、hours、days、weeks

    count是时间数量

    比如now + 5 minutes

    也可以 5pm + 2days

# 5. Linux磁盘管理

## 5.1 磁盘分区机制

### 磁盘挂载

Linux无论有几个分区，归根结底就只有一个根目录。

Linux分区是挂载在目录下的，当访问目录时也就是在访问分区。可以挂载在任意目录下

比如分区1挂载在/boot目录下，分区2挂载在swap目录下，分区3挂载在/根目录下

`lsblk` 查看磁盘分区的挂载情况;`lsblk -f`查看详细信息

### 硬盘分类

- IDE硬盘：驱动器标识符为hdx~

    - hd：表明分区所属的设备类型为IDE硬盘
    - x：盘号，abcd这样排，一块硬盘排一个
    - ~：分区，1234这样排，表示这是硬盘中的第几个分区

- SCSI硬盘：驱动器标识符为sdx~

    目前基本上是SCSI硬盘

    - sd：标识分区所属设备类型为SCSI硬盘
    - x：盘号
    - ~：分区

## 5.2 增加一块硬盘

### 命令行方式

1. 给虚拟机添加一块硬盘

    右键虚拟机-设置-添加-硬盘-选择SCSI-创建新虚拟硬盘-选择硬盘大小-起名-完成。重启系统后才能完成识别，该硬盘为sdb

2. 为硬盘分区

    1. `fdisk /dev/sdb(要分区的磁盘名路径，设备都在/dev/下)`
    2. 按m可以查看帮助，按n添加新分区
    3. 选择p：主分区或e：扩展分区
    4. 选择分成几个区
    5. 选择起始扇区（默认）
    6. 也是默认
    7. 输入w：写入分区并退出（若不保存就输入q退出）

3. 格式化分区

    `mkfs -t ext4 /dev/sdb1`

    其中ext4是分区类型，-t表示指定文件系统类型为ext4

4. 挂载分区

    可以选择任意目录挂载

    `mkdir /root/newdisk/`

    `mount /dev/sdb1 /root/newdisk/`

5. 卸载分区

    `umount /dev/sdb1`

    或者

    `umount /root/newdisk`

    得先退出/newdisk目录才能卸载

**注意事项：**

如果将分区挂载在newdisk目录下，并在目录中创建文件，然后卸载分区。

那么newdisk目录不会消失，但是其中的文件会消失。再将分区挂载在其他目录中，则目录中会出现原来的文件。

这说明文件事实上还是存储在磁盘分区中。

### 永久挂载

用命令行的方式挂载，重启后会失效

永久挂载：

1. 打开fstab文件 `vim /etx/fstab`
2. 按照格式加入自己的挂载关系，其中UUID不知道可以写设备路径/dev/sdb1（好像不行）

## 5.3 磁盘情况查询

### 磁盘各分区使用情况

`df -h` 可以查看所有磁盘分区的使用情况，比如已用容量和可用容量。-h是设置文件大小的表示单位

### 指定目录的空间占用情况

`du -h 目录` 查询指定目录的磁盘占用情况，默认为当前目录。会列出目录中所有目录及子目录，及其大小

- -s：只输出目录占用的总大小
- -h：文件大小带计量单位
- -a：不但列出目录，也列出文件
- --max-depth=1：设置列出的子目录深度
- -c：列出明细的同时，再加上一条汇总值，即该目录总共占多少空间

### 统计目录下文件的个数

`ls -l /opt | grep "^-" | wc -l`

- ls -l /opt：显示opt目录下所有文件及目录的详细信息，每个占一行
- grep "^-" ：筛选出记录中以-开头的，即筛选出文件
- wc -l：统计出行数

### 统计目录下目录的个数

`ls -l /opt | grep "^d" | wc -l`

### 统计目录下文件的个数，包括子文件夹中的

`ls -lR /opt | grep "^d" | wc -l`

### 以树状显示目录结构

`tree 目录`

要使用tree指令需要保证系统中安装了tree。使用`yum install tree`安装

# 6.Linux网络配置

## 6.1 Linux联网原理

- 在Linux中通过`ifconfig`指令可以查看网络配置情况

    其中ens33一栏是本机IP：192.168.239.128

- 在Windows中通过`ipconfig`指令可以查看网络配置情况

    其中VMnet8：192.168.239.1

    无线局域网WLAN：192.168.31.198

VMware的IP是主机分配的。VMnet8和Linux在同一网段，实际上VMware和其中的所有虚拟机系统构成了一个局域网

而本机的WLAN IP是家里的路由器分配的，通过NAT路由器（默认网关）访问外网

- `ping IP地址`可以测试当前主机是否可以连接目的服务器

## 6.2 配置虚拟机网络

### 更改配置的方式：

- 在VMware中设置

    VMware工具栏 - 编辑 - 虚拟网络编辑器，可以查看并修改虚拟网络配置信息。比如分配的子网IP

- 在Windows中设置

    右键Windows系统中右下角网络标志 - 打开"网络和Internet设置" - 下划 更改适配器选项 - 右键VMnet8点击属性 - 选中TCP/IPv4 - 属性。也可以修改分配的子网IP

### 网络分配的方式

可以在Linux图形化界面中左上角应用程序 - 系统工具 - 设置 - 网络 - 有线中的小齿轮 - IPv4可以查看IPv4Method

- 自动分配（DHCP）

    优点：自动分配IP可以保证IP不冲突

    缺点：每次分配的IP可能不一样，这样的话不能做服务器

- 指定ip

**通过修改配置文件来修改为指定ip：**

1. 打开配置文件`vim /etc/sysconfig/network-scripts/ifcfg-ens33`
2. 将BOOTPROTO（分配方式）由原来的'dhcp'改为'static'
3. 指定IP地址：添加`IPADDR=192.168.238.200(指定IP地址)`
4. 指定默认网关：添加`GATEWAY=192.168.238.2(网关IP地址)`
5. 指定域名解析器：添加`DNS1=192.168.238.2(域名解析器IP地址)`
6. 把虚拟机VMnet8的子网地址和网关地址也做相应更改

    VMWare工具栏-编辑-虚拟网络编辑器-下方修改子网IP-NAT设置-修改网关IP

7. 重启网络服务`service network restart`或重启系统生效
8. XShell中的属性也要改：右键主机名 - 属性

### 设置主机名和host映射

- `hostname` 查看主机名

- 修改配置文件`/etc/hostname`来修改主机名

- 设置host映射后，就可以通过主机名来找到linux系统，比如可以`ping 主机名`

设置host映射：

- Windows中：

    在C:\Windows\System32\drivers\etc\hosts文件中添加一行IP地址与主机名的映射`IP地址 主机名`

- Linux中：

    在/etc/hosts文件中指定主机IP地址（实际上是VMnet8的IP地址）与windows主机名的映射

这里的主机名就是一个别名，随便起，不一定真的是主机的主机名

## 6.3 虚拟机使用主机代理

1. 打开虚拟机 设置-网络-Network Proxy，改为手动，填写Socks主机一栏

    IP写主机IP，端口号写代理软件使用的端口号(可以在代理软件中查看)

2. 打开代理软件，设置允许局域网连接

# 7. 进程管理

## 7.1 进程简介

- 在LINUX中，每个正在执行的程序都是一个进程，每个进程分配一个ID号（pid）
- 每个进程都可能以两种方式存在

    - 前台：用户目前在屏幕上可以操作的
    - 后台：实际在运行，但是屏幕上无法看到

- 一般系统的服务都是以后台进程的方式存在，常驻在系统中，直到关机才结束

可以使用`ps`指令查看目前系统中执行的进程

常用参数：

- -a：显示当前终端的所有进程信息
- -u：以用户的格式显示进程信息
- -x：显示后台进程运行的参数
- -e：显示所有进程
- -f：全格式显示进程

信息项：

- USER：哪个用户执行的该进程
- PID：进程号
- %CPU：CPU占用率
- %MEM：物理内存占用率
- VSZ：进程占用的虚拟内存大小（KB）
- RSS：进程占用的物理内存大小（KB）
- TTY：终端名称（缩写）
- STAT：当前进程运行状态
    - S：sleep休眠
    - s：表示该进程是会话的先导进程
    - R：run正在运行
    - N：进程优先级较低
    - D：短期等待
    - Z：僵死进程
    - T：被跟踪或被停止
- START：进程的启动时间
- TIME：进程占用的CPU总时间
- COMMAND：启动进程所用的命令或参数

## 7.2 父子进程

一个进程创建了另一个进程，则这两个进程之间就是父子关系

用`ps -ef`指令可以显示进程的PID和PPID，其中PPID(Parent PID)就是该进程的父进程的PID

## 7.3 终止进程

`kill [选项] 进程号` 通过进程号杀死进程（不会杀死子进程）

常用选项：

- -9：强迫进程立即停止

`killall 进程名称` 通过进程名称杀死进程（及其所有子进程），支持通配符

在系统因负载过大而变得很慢时很有用

重启进程：`/bin/systemctl start 进程名称`

## 7.4 查看进程树

`pstree [选项]`

常用选项

- -p：显示进程的PID
- -u：显示进程的所属用户

## 7.5 top 动态监控进程

与ps命令相似，显示正在执行的进程。但是top指令会不断更新正在运行的进程，同时会占据整个控制台。按q退出

`top [选项]`

选项：

- -d 秒数：指定top命令隔几秒更新一次，默认是3秒

- -i：使top不显示任何闲置或者僵死进程

- -p 端口号：通过指定进程ID来仅仅监控某个进程的状态

具体信息：

|名称|含义|
|--|--|
|top|当前系统时间|
|up|系统运行时间|
|users|当前系统有几个用户|
|load average|负载值，三个数的平均值不超过0.7就没问题
|Tasks|<li>total:当前系统的任务总数</li><li>running：正在运行的任务数</li><li>sleeping：正在休眠的任务数</li><li>stopped：停止的任务数</li><li>zombie：僵死进程</li>|
|%CPU(s)|CPU占用率<li>us：用户占用的CPU</li><li>sy：系统占用的CPU</li><li>id：空闲的CPU</li>|
|Mem|<li>total：内存总共有多少</li><li>free：空闲的内存数</li><li>used：占用的内存数</li><li>buff/cache：缓冲区</li>|
|Swap|交换区使用情况|

交互操作：

|操作|功能|
|--|--|
|P|以CPU使用率排序（默认）|
|M|以内存的使用率排序|
|N|以PID排序|
|q|退出top|
|u|按下u然后输入用户名，监视指定用户的进程|
|k|按下k然后输入PID，可以杀死指定进程，输入信号量9强制结束进程|
|d|按下d可以更改更新的时间|

# 8. 服务(service)管理

服务本质就是进程，但是是运行在后台的。通常会监听某个端口等待其他程序的请求（比如mysql，sshd(XShell远程登录用)等），因此又称为守护进程

使用`setup`查看系统中的服务，其中前面框里有*星号表示该服务随着系统自启动。按空格可以更改是否自启动

## 8.1 service服务管理指令

`service 服务名 [start|stop|restart|reload|status(查看状态)]`

在CentOS7.0后，很多服务不再适用service指令管理，而是使用systemctl

依然用service指令管理的服务可以通过
`ls -l /etc/init.d/`查看

## 8.3 chkconfig 设置服务自启动

可以设置服务在各个运行级别是否自启动/关闭，管理的服务在 /etc/init.d查看

- 查看chkconfig管理服务的情况`chkconfig --list`

- `chkconfig --level 5 服务名 on/off` 使指定服务在运行级别为5时自启动/关闭

## 8.4 systemctl服务管理指令

systemctl指令管理的服务在`ls -l /usr/lib/systemd/system`查看

### 管理服务

`systemctl [start|stop|restart|status] 服务名`

### 设置服务自启动

- 查看各个服务开机启动状态 `systemctl list-unit-files` 

- 设置服务开机自启动 `systemctl enable 服务名` 

    由于Linux3和5运行级别是最常用的，因此这条指令设置3和5两个运行级别下自启动

- 关闭服务开机自启动`systemctl disable 服务名`

- 查询某个服务是否是自启动的 `systemctl is-enabled 服务名`

## 8.5 firewall 防火墙管理指令

用于在不关闭防火墙的前提下打开某些端口，使得外部请求数据包能够跟该端口通信

- 打开端口：`firewall-cmd --permanent --add-port=端口号/协议`

- 关闭端口：`firewall-cmd --permanent --remove-port=端口号/协议`

打开或关闭端口后，要重新载入才能生效：`firewall-cmd --reload`

端口对应的协议可以通过`netstat -anp`查询，一般是tcp/udp

- 查询端口是否开放：`firewall-cmd --permanent --query-port=端口号/协议`

## 8.6 netstat 监控网络状态

`netstat [选项]`

选项说明：

- -an：按一定顺序排列输出
- -p：显示哪个进程正在使用网络

返回的信息：

|名称|含义|
|--|--|
|Proto|使用的协议|
|Local Address|本地IP地址|
|Foreign Address|连接的外部IP地址|
|State|连接的状态<li>LISTEN：正在监听</li><li>ESTABLISHED：已经建立连接</li><li>TIME_WAIT：超时等待（TCP四次挥手中的一个状态）</li>|

# 9. 软件下载与安装

## 9.1 通过rpm包安装

rpm(RedHat Package Manager)是互联网下载包的打包及安装工具，生成具有.RPM扩展名的文件。类似于Windows的setup.exe

### 查看rpm包信息

- `rpm -qa` 查询系统中已安装的rpm列表

    返回的名称为：名称-版本号-适用的操作系统

    - x86_64：64位操作系统
    - i686、i386：32位操作系统
    - noarch：通用

- `rpm -q 软件包名`：查询软件是否安装

- `rpm -qi 软件包名`：查询软件的详细信息

- `rpm -ql 软件包名`：查询软件中包含的文件

- `rpm -qf 文件路径名`：查询文件所属的软件包

### rpm包安装与卸载

卸载：

`rpm -e RPM包的名称`

如果其他软件包依赖于要卸载的软件包，卸载时会产生错误信息，可以增加参数 --nodeps 强制删除，但是不推荐

安装：

`rpm -ivh RPM包路径(.RPM文件)`

参数说明：

- i：install，安装
- v：verbose，显示详细信息
- h：hash，进度条

## 9.2 通过yum安装

yum是一个shell前端软件包管理器。能够从指定服务器自动下载RPM包并且安装，可以自动处理依赖性关系，并且一次安装所有依赖的软件包

- `yum list` 列举yum服务器中所有的软件包

- `yum install 软件包名` 下载安装

- `yum remove 软件名` 卸载已安装的软件

## 9.3 配置环境变量

可以通过`echo $PATH`查看当前系统中环境变量包含的路径

1. 在`vim /etc/profile`文件中配置环境变量

    以配置JAVA_HOME为例：
    ```
    export JAVA_HOME=/usr/local/jdk8/jdk1.8.0_161
    export PATH=$JAVA_HOME/bin:$PATH
    ```

    最后的$PATH一定要加上，表示以前的PATH路径也有效

2. 刷新环境变量让配置文件生效

    `source /etc/profile`

## 9.4 通过.tar.gz压缩文件安装

直接将下载好的.tar.gz压缩文件解压即可安装完成

如果有命令，通过配置环境变量来实现全局使用命令

