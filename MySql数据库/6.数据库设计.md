# 1. 范式

范式（Normal Form，NF）主要用于指导数据库的设计

范式是关系数据库理论的基础，也是我们在设计数据库结构过程中所要遵循的规则和指导方法

**六种常见范式**，从低到高依次是：第一范式（1NF）、第二范式（2NF）、第三范式（3NF）、巴斯-科德范式（BCNF）、第四范式（4NF）、第五范式（5NF，又称完美范式）

数据库的范式越高阶，冗余度就越低。并且高阶范式一定符合低阶范式的要求，就是说如果满足了第三范式，那第一第二范式一定也满足了

同时范式的使用会降低查询效率，因为范式等级越高，设计出来的数据表就越多，导致查询时要频繁进行多表连接。

**实际开发**中，最高也就遵循到巴斯范式，一般都是第三范式。甚至在某些时候还要破坏范式以提高查询效率，称为反范式

![规范化过程](E:\myNote-of-ComputerStudy\MySql数据库\规范化过程.jpg)

## 1.1 第一范式

**第一范式要求**：确保数据表中的每个字段的值必须具有原子性，也就是说数据表中 每个字段的值 都是不可再次拆分的最小数据单元。

事实上，任何DBMS都会满足第一范式。

比如说：user表中有一个字段是用户信息，里面包含了用户的真实姓名、电话、住址等信息，这就是不符合第一范式的，需要把这几个字段再拆开

**属性的原子性是主观的**

比如说：地址应该做为一个整体，还是再拆成省、市、街道呢。这应该取决于应用程序的实际需要。

## 1.2 第二范式

### 1.2.1 函数依赖

函数依赖就是，给我一些属性值，我就能在表中唯一的确定一条记录。那么给定的属性值就 函数确定 记录中其他的属性值

比如R（x，y），x是主键，那确定了x就能唯一确定y的值，称X函数确定Y 或 Y函数依赖于X 记作 X-->Y

**完全函数依赖**  对于由多个属性组成的主键，必须确定所有主键之后才能确定其余的值

**部分函数依赖** R（x，y，z，a），（x，y）是主键，只有确定了x和y才能确定z，则z完全依赖于（x，y）；而对于a，确定了x就能确定a，跟y没关系，则a部分依赖于（x，y）

### 1.2.2 2NF

**第二范式要求**：在满足第一范式的基础上，还要满足 

1. 数据表里的每一条数据记录，都是可唯一标识的（用主键来唯一标识）

   也就是说不存在两条一模一样的记录，因为在最坏情况下主键可以设置为所有字段

2. 所有的非主键字段，必须完全依赖主键，不能只依赖主键的一部分

   比如说，主键有两个字段组成，那就必须告诉我这两个字段，我才能唯一确定出要找的非主键字段的值，这叫完全依赖。如果只告诉我其中一个主键字段，我就能找到指定的非主键字段的值，这叫部分依赖。

   如果存在不完全依赖，那这些属性和它部分依赖的主键应该分离出来形成新的表

**满足第二范式的例子**

`成绩表（学号，课程，成绩）`

其中主键为（学号，课程）。只有知道了学号和课程，才能知道这位同学这门课考的分数

**不满足第二范式的例子**

`比赛表（球员编号，比赛编号，姓名，年龄，比赛时间，比赛场地，得分）`

其中主键为（球员编号，比赛编号）。

如果我们想知道得分，那我们就必须知道球员编号和比赛编号。说明这个字段完全依赖主键

但是如果我们只想知道球员的姓名和年龄，那我们就只需要知道球员编号，而不需要知道比赛编号；如果我们想知道比赛时间和比赛场地，那就只需要知道比赛编号。说明这几个字段部分依赖主键

**为什么要完全依赖**

1. 为了降低数据的冗余度

   如果一个球员参加m场比赛，那球员的姓名和年龄就重复m-1次；如果一个比赛有n个球员参加，比赛的时间和地点就重复n-1次

2. 防止插入异常

   如果我们想插入一场新的比赛，但是还没确定参加的球员，那就没法插入

3. 防止删除异常

4. 防止更新异常

   本来改一场比赛的时间应该只需要改一个字段，但是现在需要同步改很多字段

## 1.3 第三范式

**第三范式要求**：在第一、二范式的基础上，确保数据表中的每一个非主键字段都和主键字段直接相关。也就是说数据表中的所有非主键属性之间要相互独立，不能有依赖关系。

**举例：**

`商品表（商品id，商品类别id，商品类别名称，商品名称，商品价格）`

这张表中商品id是主键

这张表不符合第三范式，因为在确定商品类别id之后，商品类别名称也就确定了，即商品类别名称依赖于一个非主键 商品类别id

可以把商品类别id和商品类别名称再抽出，形成一张表。然后商品表中只保存商品类别id



第二三范式可以总结为：每个非主键属性 依赖且仅依赖于整个主键。

**反范式化**

我们要遵循业务优先的原则，首先满足业务需求，再尽量减少冗余

以空间换时间，只是提升了查的性能，因为在进行数据的增删改时，冗余字段要同步修改

## 1.4 巴斯范式BCNF

巴斯范式，也叫巴斯-科德范式（Boyce-Codd Normal Form）。只是在第三范式的基础上进行了改进，被称为是修正的第三范式，或扩充的第三范式

巴斯范式要求：除了非主属性不能部分依赖于主键，主属性也不能部分依赖于其他候选键（即所有主属性都完全依赖于每个不包含它的候选码）

## 1.4 第四范式

### 1.4.1 多值依赖

多值依赖是函数依赖的特例

多值依赖指表中的一对多的关系，比如说一个老师可以教多门课

**平凡的多值依赖**

一张表中只有一个多值依赖关系

**非平凡的多值依赖关系**

一张表中有多个一对多的关系

比如 Course（Teacher，Course，Book）

一个老师可以教多门课，每门课可以用不同的教材，每门课也可以由不同的老师教。就出现了多个一对多的关系

### 1.4.2 4NF

第四范式在BCNF的基础上，消除非平凡且非函数的多值依赖。

也就是说要把同一张表内的多对多关系删除（多个一对多关系就会构成多对多关系）

第四范式要求任何非主属性都不能同时依赖于多个候选键

# 2. 数据库设计

数据库设计分为以下六个阶段

- 需求分析
- 概念结构设计
- 逻辑结构设计
- 物理结构设计
- 数据库实施
- 数据库运行和维护

![数据库各级模式](E:\myNote-of-ComputerStudy\MySql数据库\数据库各级模式.jpg)

## 2.1 需求分析

设计数据库首先必须准确了解与分析用户需求。需求分析是整个设计过程的基础，是最困难和最耗费时间的一步。

需求分析可以形成一个数据字典

### 2.1.1 数据字典

数据字典是对数据库中数据的描述（即元数据），而不是数据本身。

数据字典主要包括数据项、数据结构、数据流、数据存储和处理过程几部分。

**数据项**

数据项是不可再分的数据单位，即一个属性

对数据项的描述 = {数据项名，数据项含义说明，别名，数据类型，长度，取值范围，取值含义，与其他数据项的逻辑关系，数据项之间的联系}

**数据结构**

若干个数据项或数据结构可以组成一个数据结构。可以理解为对一整张表的结构的描述

对数据结构的描述 = {数据结构名，含义说明，组成：{数据项或数据结构}

**数据流**

数据流是数据结构在系统中传输的路径

对数据流的描述 = {数据流名，说明，数据流来源，数据流去向，组成：{数据结构}，平均流量，高峰期流量}

**数据存储**

数据存储是 数据结构停留或保存的地方，也是数据流的来源和去向之一

它可以是手工文档或手工凭单，也可以是计算机文档

对数据存储的描述 = {数据存储名，说明，编号，输入的数据流，输出的数据流，组成：{数据结构}，数据量，存取频度，存取方式}

**处理过程**

相当于一个函数定义，在数据字典中只需说明处理过程的功能及处理要求，即该处理过程用来做什么（而不是怎么做）

对处理过程的描述 = {处理过程名，说明，输入：{数据流}，输出：{数据流}，处理：{简要说明}}

## 2.2 概念结构设计

将需求分析得到的用户需求（数据字典）抽象为概念模型（比如E-R模型）的过程就是概念结构设计。

**E-R模型一个例子：**

![E-R图示例](E:\myNote-of-ComputerStudy\软件工程概论\E-R图示例.jpg)

## 2.3 逻辑结构设计

逻辑结构设计的任务是把概念结构设计阶段设计好的基本E-R图转换为 与 选用数据库管理系统产品所支持的数据模型 相符合的逻辑结构

也就是把 E-R图 转化为关系模型
