# 1. 项目搭建

## 1.1 搭建本地开发环境

## 1.2 部署上线

# 2. 功能实现细节

## 2.1 后台管理员登录

1. 接收参数：用户名/手机号/邮箱、密码、是否记住帐号密码

2. 判断帐号密码是否为空

3. 验证该ip地址是否被禁止登录

   在Redis中保存了每个ip的登录失败次数，key为`LOGIN_LIMIT:ip`。这步会取出当前ip的登录失败错误并验证是否超出最大登录次数限制

4. 判断输入的用户名类型，并根据用户名封装查询条件QueryWrapper并查询

   用正则表达式判断输入的用户名是手机号、邮箱、用户名中的哪种类型，根据输入的类型决定用户输入的username与哪个字段匹配。

   查询出对应的user对象

5. 验证密码

   对密码采用加盐加密验证，采用SHA-256 + 随机盐动态加盐 + 密钥对密码进行加密

6. 根据roleUids字段查询登录用户权限

7. 生成JWT token

   jwt token中存储了用户名等用户信息，以及该token的过期时间

8. 更新登录用户的登录信息

   比如：登录次数、上次登录ip、上次登录时间

9. 将当前用户添加到Redis中的在线管理员列表中，并设置过期时间

   key是jwt token，value是该管理员admin对象对应的json字符串

## 2.2 登录认证

jwt认证工作放在了mogu_admin微服务中的一个Filter过滤器中，JwtAuthenticationTokenFilter

1. 从请求头的Authorization字段中获取jwt token

   如果获取不到，说明还没登录，直接执行后面的filter方法

2. 根据jwt token做验证

   - 在redis的在线管理员列表中查找对应的管理员对象是否依然在线
   - 解析jwt token取出其中的过期时间，看该token是否已经过期

   如果验证失败，则直接执行后面的filter方法，并返回